<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neon Flappy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .glow {
        box-shadow: 0 0 18px rgba(34, 211, 238, 0.7), 0 0 36px rgba(217, 70, 239, 0.35);
      }
      .panel {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(16px);
      }
      canvas { display:block; }
    </style>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <div class="fixed inset-0 pointer-events-none">
      <div class="absolute -top-24 -left-24 h-80 w-80 rounded-full bg-cyan-500/30 blur-[120px]"></div>
      <div class="absolute top-32 right-0 h-96 w-96 rounded-full bg-fuchsia-500/25 blur-[140px]"></div>
      <div class="absolute bottom-0 left-1/3 h-72 w-72 rounded-full bg-emerald-500/20 blur-[120px]"></div>
    </div>

    <main class="relative z-10 w-screen h-screen flex items-center justify-center">
      <div class="panel glow w-full h-full">
        <div class="relative w-full h-full">
          <canvas id="game" class="w-full h-full"></canvas>

          <!-- HUD -->
          <div class="absolute top-4 left-4 z-20 flex gap-3 text-sm pointer-events-none">
            <div class="px-3 py-2 rounded-lg bg-white/10">Score: <span id="score" class="text-cyan-200 font-semibold">0</span></div>
            <div class="px-3 py-2 rounded-lg bg-white/10">Best: <span id="best" class="text-fuchsia-200 font-semibold">0</span></div>
          </div>

          <!-- Buttons inside game -->
          <div class="absolute top-4 right-4 z-30 flex gap-2">
            <button id="startBtn" class="px-4 py-2 rounded-lg bg-cyan-500/80 text-white hover:bg-cyan-400/80">Start</button>
            <button id="resetBtn" class="px-4 py-2 rounded-lg border border-white/10 text-slate-200 hover:bg-white/5">Reset</button>
            <button id="soundBtn" class="px-4 py-2 rounded-lg border border-white/10 text-slate-200 hover:bg-white/5">Sound: On</button>
          </div>

          <!-- Overlays -->
          <div id="startOverlay" class="absolute inset-0 z-10 flex items-center justify-center text-center">
            <div class="panel glow rounded-2xl px-8 py-6">
              <div class="text-2xl font-semibold text-cyan-200">Neon Flappy</div>
              <div class="text-sm text-slate-300 mt-2">Press Start or Space to begin</div>
            </div>
          </div>
          <div id="gameOverOverlay" class="absolute inset-0 z-10 hidden items-center justify-center text-center">
            <div class="panel glow rounded-2xl px-8 py-6">
              <div class="text-2xl font-semibold text-fuchsia-200">Game Over</div>
              <div id="restartText" class="text-sm text-slate-300 mt-2">Restarting in 2...</div>
            </div>
          </div>

          <div id="status" class="absolute bottom-4 left-1/2 -translate-x-1/2 z-20 text-xs text-slate-300 bg-white/10 px-4 py-2 rounded-full pointer-events-none">Ready</div>
        </div>
      </div>
    </main>

    <script>
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');
      const scoreEl = document.getElementById('score');
      const bestEl = document.getElementById('best');
      const statusEl = document.getElementById('status');
      const startBtn = document.getElementById('startBtn');
      const resetBtn = document.getElementById('resetBtn');
      const soundBtn = document.getElementById('soundBtn');
      const startOverlay = document.getElementById('startOverlay');
      const gameOverOverlay = document.getElementById('gameOverOverlay');
      const restartText = document.getElementById('restartText');

      let bestScore = Number(localStorage.getItem('neon-flappy-best') || 0);
      bestEl.textContent = bestScore;

      let state = 'start'; // start | playing | gameover
      let score = 0;
      let lastTime = 0;
      let timeAccumulator = 0;
      let soundOn = true;
      let restartCountdown = 2;

      const bird = {
        x: 140,
        y: 200,
        r: 16,
        vy: 0,
        gravity: 900,
        lift: -360,
      };

      const pipes = [];
      const particles = [];
      const pipeGap = 170;
      const pipeWidth = 70;
      const pipeSpeed = 220;

      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      function beep(freq, duration = 0.08, volume = 0.05) {
        if (!soundOn) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.value = freq;
        gain.gain.value = volume;
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
      }

      function resize() {
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        if (state !== 'playing') draw();
      }
      window.addEventListener('resize', resize);

      function resetGame() {
        score = 0;
        bird.y = canvas.height / 2;
        bird.vy = 0;
        pipes.length = 0;
        particles.length = 0;
        scoreEl.textContent = score;
        statusEl.textContent = 'Ready';
      }

      function startGame() {
        state = 'playing';
        startOverlay.classList.add('hidden');
        gameOverOverlay.classList.add('hidden');
        statusEl.textContent = 'Go!';
        resetGame();
      }

      function spawnPipe() {
        const gapTop = Math.random() * (canvas.height - pipeGap - 140) + 70;
        pipes.push({ x: canvas.width + 40, gapTop, scored: false });
      }

      function addParticles() {
        for (let i = 0; i < 6; i++) {
          particles.push({
            x: bird.x - bird.r,
            y: bird.y,
            vx: -80 - Math.random() * 60,
            vy: (Math.random() - 0.5) * 120,
            life: 0.4 + Math.random() * 0.3,
          });
        }
      }

      function flap() {
        if (state !== 'playing') return;
        bird.vy = bird.lift;
        addParticles();
        beep(520);
      }

      function collide(pipe) {
        const withinX = bird.x + bird.r > pipe.x && bird.x - bird.r < pipe.x + pipeWidth;
        if (!withinX) return false;
        const hitTop = bird.y - bird.r < pipe.gapTop;
        const hitBottom = bird.y + bird.r > pipe.gapTop + pipeGap;
        return hitTop || hitBottom;
      }

      function update(dt) {
        if (state !== 'playing') return;

        bird.vy += bird.gravity * dt;
        bird.y += bird.vy * dt;

        timeAccumulator += dt;
        if (timeAccumulator > 1.6) {
          spawnPipe();
          timeAccumulator = 0;
        }

        for (const pipe of pipes) {
          pipe.x -= pipeSpeed * dt;
          if (!pipe.scored && pipe.x + pipeWidth < bird.x) {
            pipe.scored = true;
            score++;
            scoreEl.textContent = score;
            statusEl.textContent = 'Nice!';
            beep(760);
          }
        }

        if (pipes.length && pipes[0].x + pipeWidth < -40) pipes.shift();

        for (const p of particles) {
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.life -= dt;
        }
        while (particles.length && particles[0].life <= 0) particles.shift();

        if (bird.y - bird.r < 0 || bird.y + bird.r > canvas.height) {
          endGame();
        }

        for (const pipe of pipes) {
          if (collide(pipe)) {
            endGame();
            break;
          }
        }
      }

      function endGame() {
        state = 'gameover';
        statusEl.textContent = 'Game Over!';
        beep(220, 0.2, 0.08);
        if (score > bestScore) {
          bestScore = score;
          localStorage.setItem('neon-flappy-best', score);
          bestEl.textContent = score;
        }
        gameOverOverlay.classList.remove('hidden');
        restartCountdown = 2;
      }

      function drawBackground() {
        ctx.fillStyle = '#0b1020';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, 'rgba(34,211,238,0.15)');
        gradient.addColorStop(1, 'rgba(217,70,239,0.08)');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      function drawPipes() {
        for (const pipe of pipes) {
          const pipeGradient = ctx.createLinearGradient(pipe.x, 0, pipe.x + pipeWidth, 0);
          pipeGradient.addColorStop(0, 'rgba(34,211,238,0.8)');
          pipeGradient.addColorStop(1, 'rgba(14,116,144,0.9)');
          ctx.fillStyle = pipeGradient;
          ctx.shadowColor = 'rgba(34,211,238,0.6)';
          ctx.shadowBlur = 14;
          ctx.fillRect(pipe.x, 0, pipeWidth, pipe.gapTop);
          ctx.fillRect(pipe.x, pipe.gapTop + pipeGap, pipeWidth, canvas.height);
        }
        ctx.shadowBlur = 0;
      }

      function drawParticles() {
        ctx.fillStyle = 'rgba(34,211,238,0.8)';
        for (const p of particles) {
          ctx.globalAlpha = Math.max(p.life, 0);
          ctx.beginPath();
          ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
      }

      function drawBird() {
        ctx.save();
        ctx.translate(bird.x, bird.y);
        ctx.rotate(Math.min(Math.max(bird.vy / 600, -0.5), 0.5));
        ctx.beginPath();
        ctx.fillStyle = 'rgba(236,72,153,0.95)';
        ctx.shadowColor = 'rgba(236,72,153,0.7)';
        ctx.shadowBlur = 16;
        ctx.arc(0, 0, bird.r, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        // wing
        ctx.beginPath();
        ctx.fillStyle = 'rgba(255,255,255,0.7)';
        ctx.ellipse(-4, 2, 8, 4, 0, 0, Math.PI * 2);
        ctx.fill();
        // eye
        ctx.beginPath();
        ctx.fillStyle = '#0b1020';
        ctx.arc(6, -4, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      function draw() {
        drawBackground();
        drawPipes();
        drawParticles();
        drawBird();
      }

      function loop(timestamp) {
        const dt = Math.min((timestamp - lastTime) / 1000, 0.03) || 0;
        lastTime = timestamp;
        update(dt);
        draw();

        if (state === 'gameover') {
          restartCountdown -= dt;
          restartText.textContent = `Restarting in ${Math.ceil(restartCountdown)}...`;
          if (restartCountdown <= 0) {
            gameOverOverlay.classList.add('hidden');
            startGame();
          }
        }

        requestAnimationFrame(loop);
      }

      startBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        startGame();
      });

      resetBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        state = 'start';
        resetGame();
        startOverlay.classList.remove('hidden');
        gameOverOverlay.classList.add('hidden');
      });

      soundBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        soundOn = !soundOn;
        soundBtn.textContent = `Sound: ${soundOn ? 'On' : 'Off'}`;
        if (audioCtx.state === 'suspended') audioCtx.resume();
      });

      window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          if (audioCtx.state === 'suspended') audioCtx.resume();
          if (state !== 'playing') startGame();
          flap();
        }
      });

      canvas.addEventListener('click', () => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        if (state !== 'playing') startGame();
        flap();
      });

      resize();
      resetGame();
      requestAnimationFrame(loop);
    </script>
  </body>
</html>
